<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BookingSync API documentation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/stylesheets/application.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/prism.css">
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="/assets/javascripts/application.js"></script>
    <script src="/js/prism.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.8.0">
  </head>
  <body class="flex-col">
    <div class="page-wrapper flex-1 flex-col">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle sidebar-toggle collapsed" data-toggle="collapse" data-target="#navigation" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <img alt="BookingSync" src="/images/smily-logo.png">
              <span>Developers</span>
            </a>
          </div>

          <div class="collapse navbar-collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
              <li class="active">
                <a href="/guides/">Guides</a>
              </li>
              <li class="">
                <a href="https://demo.platforms.bookingsync.com/api-docs/index.html" target="_blank">API Reference</a>
              </li>
              <li><a href="https://www.smily.com" target="_blank">Smily.com</a></li>
              <li><a href="https://github.com/BookingSync/channel-api-docs" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a></li>
            </ul>
          </div>
        </div>
      </nav>

<div class="container content">
  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <div class="panel panel-default">
        <div class="list-group">
          <a class="list-group-item" href="/guides/">API overview</a>
          <a class="list-group-item" href="/guides/getting-started/">Getting Started</a>
          <a class="list-group-item" href="/guides/accounts-synchronization/">Accounts synchronization</a>
          <a class="list-group-item" href="/guides/rentals-synchronization/">Rentals synchronization</a>
          <a class="list-group-item" href="/guides/create-a-booking-payments-on-partner-side/">Create a booking (payments on partner side)</a>
          <a class="list-group-item" href="/guides/create-a-booking-with-smily-payment-gateway/">Create a booking (payments on our side)</a>
          <a class="list-group-item active" href="/guides/booking-cancelation/">Booking cancelation</a>
        </div>
      </div>
    </div>
    <div class="col-md-9 col-md-pull-3">
      <div class="panel panel-default">
        <div class="panel-body guide-body">
          <h2 id="booking-cancelation">Booking Cancelation</h2>

<ol id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#booking-cancellation-process" id="markdown-toc-booking-cancellation-process">Booking Cancellation Process</a></li>
</ol>

<h3 id="preface">Preface</h3>

<p>The Booking Cancellation API allows you to cancel bookings according to the rental’s cancellation policy. The cancellation policy can be retrieved from the rental’s endpoint and includes details such as eligible cancellation days and penalty percentages.</p>

<p>The cancellations and modifications made on the bookings both initiated by the guest or the PMs need to be made on the channel side which will then reflect in the Smily interface.</p>

<blockquote>
  <p><strong>Please note</strong> that PMs can’t make cancellations directly in the Smily system so the cancellation has to be made by your channel.</p>
</blockquote>

<pre><code class="language-js">  "cancelation-policy-items": [
    {
      "id": "1",
      "penalty-percentage": 10,
      "eligible-days": 2,
      "message-translations": {
        "en": "Lorem ipsum",
        "fr": "Lorem ipsum"
      }
    }
  ]
</code></pre>

<p>In this example, a booking can be canceled up to 2 days before check-in with a penalty of 10% from the booking’s final price.</p>

<h3 id="booking-cancellation-process">Booking Cancellation Process</h3>

<p>To cancel a booking, follow these steps:</p>

<ol>
  <li>Retrieve the cancellation policy from the rental’s endpoint. Refer to the <a href="https://demo.platforms.bookingsync.com/api-docs/index.html">Swagger documentation</a> for detailed specifications.</li>
  <li>Use the provided cancellation policy to determine the eligible cancellation days and penalty percentage.</li>
  <li>Make a PATCH request to the booking cancellation endpoint:</li>
</ol>

<div class="tabbable"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#content-1-0">cURL</a></li>
<li class=""><a data-toggle="tab" href="#content-1-1">Ruby</a></li>
<li class=""><a data-toggle="tab" href="#content-1-2">Python</a></li>
<li class=""><a data-toggle="tab" href="#content-1-3">Java</a></li></ul><div class="tab-content"><div id="content-1-0" class="tab-pane fade in active"><pre><code class="language-bash">TOKEN="YOUR_TOKEN"
API_URL="API_URL"
BOOKING_ID="111"

curl -X PATCH \
  '$API_URL/bookings/$BOOKING_ID/cancel' \
  -H 'User-Agent: Api client' \
  -H 'Accept: application/vnd.api+json' \
  -H 'Content-Type: application/vnd.api+json' \
  -H 'Authorization: Bearer $TOKEN' \
  -d '{
    "data": {
      "type": "bookings",
      "id": "$BOOKING_ID",
      "attributes": {
        "cancelation-reason": "canceled_by_traveller_other",
        "cancelation-description": "health concern",
        "channel-cancelation-cost": "80.0",
        "currency": "USD"
      }
    }
  }'</code></pre></div>
<div id="content-1-1" class="tab-pane fade in "><pre><code class="language-ruby">token = "YOUR_TOKEN"
api_url = "API_URL"
media_type = "application/vnd.api+json"

# Set headers and options for the request
headers = {
  "User-Agent": "Api client",
  "Accept": media_type,
  "Content-Type": media_type,
  "Authorization": "Bearer #{token}"
}

options = {
  headers: headers
}

# Construct the request
booking_id = "BOOKING_ID"
cancelation_reason = "canceled_by_traveller_other"
cancelation_description = "health concern"
channel_cancelation_cost = "80.0"
currency = "USD"

payload = {
  data: {
    type: "bookings",
    id: booking_id,
    attributes: {
      "cancelation-reason": cancelation_reason,
      "cancelation-description": cancelation_description,
      "channel-cancelation-cost": channel_cancelation_cost,
      "currency": currency
    }
  }
}

request_url = URI.join(api_url, "/bookings/#{booking_id}/cancel").to_s
request = Excon.new(request_url, options)

# Send the request and handle the response
response = request.request(method: :patch, body: payload.to_json)
json = JSON.parse(response.body)

if response.status == 200
  booking_canceled_at = json["data"]["attributes"]["canceled-at"]
  # Update new booking information
else
  handle_errors(json)
end</code></pre></div>
<div id="content-1-2" class="tab-pane fade in "><pre><code class="language-python">import requests
import json

token = "YOUR_TOKEN"
api_url = "API_URL"
media_type = "application/vnd.api+json"

# Set headers for the request
headers = {
    "User-Agent": "Api client",
    "Accept": media_type,
    "Content-Type": media_type,
    "Authorization": f"Bearer {token}"
}

# Construct the request
booking_id = "BOOKING_ID"
cancelation_reason = "canceled_by_traveller_other"
cancelation_description = "health concern"
channel_cancelation_cost = "80.0"
currency = "USD"

payload = {
    "data": {
        "type": "bookings",
        "id": booking_id,
        "attributes": {
            "cancelation-reason": cancelation_reason,
            "cancelation-description": cancelation_description,
            "channel-cancelation-cost": channel_cancelation_cost,
            "currency": currency
        }
    }
}

request_url = f"{api_url}/bookings/{booking_id}/cancel"

# Send the request and handle the response
response = requests.patch(request_url, headers=headers, data=json.dumps(payload))
response_json = response.json()

if response.status_code == 200:
    booking_canceled_at = response_json["data"]["attributes"]["canceled-at"]
    # Update new booking information
else:
    handle_errors(response_json)</code></pre></div>
<div id="content-1-3" class="tab-pane fade in "><pre><code class="language-java">import okhttp3.*;
import org.json.JSONObject;

import java.io.IOException;

public class CancelBooking {

    private static final String TOKEN = "YOUR_TOKEN";
    private static final String API_URL = "API_URL";
    private static final String MEDIA_TYPE = "application/vnd.api+json";

    public static void main(String[] args) {
        OkHttpClient client = new OkHttpClient();
        MediaType mediaType = MediaType.parse(MEDIA_TYPE);
        String bookingId = "YOUR_BOOKING_ID"; // Replace with your actual booking id

        JSONObject payload = new JSONObject();
        payload.put("type", "bookings");
        payload.put("id", bookingId);
        JSONObject attributes = new JSONObject();
        attributes.put("cancelation-reason", "canceled_by_traveller_other");
        attributes.put("cancelation-description", "health concern");
        attributes.put("channel-cancelation-cost", "80.0");
        attributes.put("currency", "USD");
        payload.put("attributes", attributes);

        RequestBody body = RequestBody.create(mediaType, payload.toString());

        Request request = new Request.Builder()
                .url(API_URL + "/bookings/" + bookingId + "/cancel")
                .patch(body)
                .addHeader("User-Agent", "Api client")
                .addHeader("Accept", MEDIA_TYPE)
                .addHeader("Content-Type", MEDIA_TYPE)
                .addHeader("Authorization", "Bearer " + TOKEN)
                .build();

        try {
            Response response = client.newCall(request).execute();
            int responseStatus = response.code();

            if (responseStatus == 200) {
                JSONObject jsonResponse = new JSONObject(response.body().string());
                String bookingCanceledAt = jsonResponse.getJSONObject("data").getJSONObject("attributes").getString("canceled-at");
                // Update new booking information
                System.out.println("Booking canceled at: " + bookingCanceledAt);
            } else {
                // Handle errors
                System.out.println("Error: " + response.body().string());
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}</code></pre></div></div></div>

        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </body>
</html>

