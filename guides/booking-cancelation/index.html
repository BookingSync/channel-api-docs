<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BookingSync API documentation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/stylesheets/application.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/highlight.css">
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="/assets/javascripts/application.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.8.0">
  </head>
  <body class="flex-col">
    <div class="page-wrapper flex-1 flex-col">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle sidebar-toggle collapsed" data-toggle="collapse" data-target="#navigation" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <img alt="BookingSync" src="/images/bookingsync.svg">
              <span>Developers</span>
            </a>
          </div>

          <div class="collapse navbar-collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
              <li class="active">
                <a href="/guides/">Guides</a>
              </li>
              <li class="">
                <a href="https://demo.platforms.bookingsync.com/api-docs/index.html" target="_blank">API Reference</a>
              </li>
              <li><a href="https://www.smily.com" target="_blank">Smily.com</a></li>
              <li><a href="https://github.com/BookingSync/channel-api-docs" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a></li>
            </ul>
          </div>
        </div>
      </nav>

<div class="container content">
  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <div class="panel panel-default">
        <div class="list-group">
          <a class="list-group-item" href="/guides/api-overview">API overview</a>
          <a class="list-group-item" href="/guides/getting-started">Getting Started</a>
          <a class="list-group-item" href="/guides/accounts-synchronization">Accounts synchronization</a>
          <a class="list-group-item" href="/guides/rentals-synchronization">Rentals synchronization</a>
          <a class="list-group-item" href="/guides/create-a-booking-payments-on-partner-side">Create a booking (payments on partner side)</a>
          <a class="list-group-item" href="/guides/create-a-booking-with-smily-payment-gateway">Create a booking (payments on our side)</a>
          <a class="list-group-item" href="/guides/booking-cancelation">Booking cancelation</a>
        </div>
      </div>
    </div>
    <div class="col-md-9 col-md-pull-3">
      <div class="panel panel-default">
        <div class="panel-body guide-body">
          <h2 id="booking-cancelation">Booking Cancelation</h2>

<ol id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#booking-cancellation-process" id="markdown-toc-booking-cancellation-process">Booking Cancellation Process</a></li>
  <li><a href="#possible-validation-error" id="markdown-toc-possible-validation-error">Possible Validation Error</a></li>
</ol>

<h3 id="preface">Preface</h3>

<p>The Booking Cancellation API allows you to cancel bookings according to the rental’s cancellation policy. The cancellation policy can be retrieved from the rental’s endpoint and includes details such as eligible cancellation days and penalty percentages.</p>

<pre><code class="language-js">  <span class="s2">"cancelation-policy-items"</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="o">:</span> <span class="s2">"1"</span><span class="p">,</span>
      <span class="s2">"penalty-percentage"</span><span class="o">:</span> <span class="mf">10</span><span class="p">,</span>
      <span class="s2">"eligible-days"</span><span class="o">:</span> <span class="mf">2</span><span class="p">,</span>
      <span class="s2">"message-translations"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"en"</span><span class="o">:</span> <span class="s2">"Lorem ipsum"</span><span class="p">,</span>
        <span class="s2">"fr"</span><span class="o">:</span> <span class="s2">"Lorem ipsum"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span></code></pre>

<p>In this example, a booking can be canceled up to 2 days before check-in with a penalty of 10% from the booking’s final price.</p>

<h3 id="booking-cancellation-process">Booking Cancellation Process</h3>

<p>To cancel a booking, follow these steps:</p>

<ol>
  <li>Retrieve the cancellation policy from the rental’s endpoint. Refer to the <a href="https://demo.platforms.bookingsync.com/api-docs/index.html">Swagger documentation</a> for detailed specifications.</li>
  <li>Use the provided cancellation policy to determine the eligible cancellation days and penalty percentage.</li>
  <li>Make a PATCH request to the booking cancellation endpoint:</li>
</ol>

<pre><code class="language-ruby"><span class="n">token</span> <span class="o">=</span> <span class="s2">"&lt;YOUR_TOKEN&gt;"</span>
<span class="n">api_url</span> <span class="o">=</span> <span class="s2">"&lt;API_URL&gt;"</span>
<span class="n">media_type</span> <span class="o">=</span> <span class="s2">"application/vnd.api+json"</span>

<span class="c1"># Set headers and options for the request</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"User-Agent"</span><span class="p">:</span> <span class="s2">"Api client"</span><span class="p">,</span>
  <span class="s2">"Accept"</span><span class="p">:</span> <span class="n">media_type</span><span class="p">,</span>
  <span class="s2">"Content-Type"</span><span class="p">:</span> <span class="n">media_type</span><span class="p">,</span>
  <span class="s2">"Authorization"</span><span class="p">:</span> <span class="s2">"Bearer </span><span class="si">#{</span><span class="n">token</span><span class="si">}</span><span class="s2">"</span>
<span class="p">}</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">headers</span><span class="p">:</span> <span class="n">headers</span>
<span class="p">}</span>

<span class="c1"># Construct the request</span>
<span class="n">booking_id</span> <span class="o">=</span> <span class="s2">"&lt;BOOKING_ID&gt;"</span>
<span class="n">cancelation_reason</span> <span class="o">=</span> <span class="s2">"canceled_by_traveller_other"</span>
<span class="n">cancelation_description</span> <span class="o">=</span> <span class="s2">"health concern"</span>
<span class="n">channel_cancelation_cost</span> <span class="o">=</span> <span class="s2">"80.0"</span>
<span class="n">currency</span> <span class="o">=</span> <span class="s2">"USD"</span>

<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="ss">type</span><span class="p">:</span> <span class="s2">"bookings"</span><span class="p">,</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">booking_id</span><span class="p">,</span>
    <span class="ss">attributes</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"cancelation-reason"</span><span class="p">:</span> <span class="n">cancelation_reason</span><span class="p">,</span>
      <span class="s2">"cancelation-description"</span><span class="p">:</span> <span class="n">cancelation_description</span><span class="p">,</span>
      <span class="s2">"channel-cancelation-cost"</span><span class="p">:</span> <span class="n">channel_cancelation_cost</span><span class="p">,</span>
      <span class="s2">"currency"</span><span class="p">:</span> <span class="n">currency</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">request_url</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="s2">"/bookings/</span><span class="si">#{</span><span class="n">booking_id</span><span class="si">}</span><span class="s2">/cancel"</span><span class="p">)</span><span class="o">.</span><span class="n">to_s</span>
<span class="n">request</span> <span class="o">=</span> <span class="no">Excon</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>

<span class="c1"># Send the request and handle the response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="nb">method</span><span class="p">:</span> <span class="ss">:patch</span><span class="p">,</span> <span class="ss">body</span><span class="p">:</span> <span class="n">payload</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span>
<span class="n">json</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>

<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span>
  <span class="n">booking_canceled_at</span> <span class="o">=</span> <span class="n">json</span><span class="o">[</span><span class="s2">"data"</span><span class="o">][</span><span class="s2">"attributes"</span><span class="o">][</span><span class="s2">"canceled-at"</span><span class="o">]</span>
  <span class="c1"># Update new booking information</span>
<span class="k">else</span>
  <span class="n">handle_errors</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="k">end</span></code></pre>

<h3 id="possible-validation-error">Possible Validation Error</h3>

<p>In case of a validation error, the response will resemble the following:</p>

<pre><code class="language-js">  <span class="p">{</span>
    <span class="s2">"errors"</span> <span class="p">=&gt;</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"code"</span> <span class="p">=&gt;</span> <span class="s2">"100"</span><span class="p">,</span>
        <span class="s2">"detail"</span> <span class="p">=&gt;</span> <span class="s2">"currency - provided currency for cancelation must be the same as the one from booking"</span><span class="p">,</span>
        <span class="s2">"source"</span> <span class="p">=&gt;</span> <span class="p">{</span>
          <span class="s2">"pointer"</span> <span class="p">=&gt;</span> <span class="s2">"/data/attributes/currency"</span>
        <span class="p">},</span>
        <span class="s2">"status"</span> <span class="p">=&gt;</span> <span class="s2">"422"</span><span class="p">,</span>
        <span class="s2">"title"</span> <span class="p">=&gt;</span> <span class="s2">"provided currency for cancelation must be the same as the one from booking"</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span></code></pre>

        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </body>
</html>

