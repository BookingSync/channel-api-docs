<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>BookingSync API documentation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/stylesheets/application.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/prism.css">
    <script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="/assets/javascripts/application.js"></script>
    <script src="/js/prism.js"></script>

    <!-- you don't need to keep this, but it's cool for stats! -->
    <meta name="generator" content="nanoc 3.8.0">
  </head>
  <body class="flex-col">
    <div class="page-wrapper flex-1 flex-col">
      <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle sidebar-toggle collapsed" data-toggle="collapse" data-target="#navigation" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
              <img alt="BookingSync" src="/images/bookingsync.svg">
              <span>Developers</span>
            </a>
          </div>

          <div class="collapse navbar-collapse" id="navigation">
            <ul class="nav navbar-nav navbar-right">
              <li class="active">
                <a href="/guides/">Guides</a>
              </li>
              <li class="">
                <a href="https://demo.platforms.bookingsync.com/api-docs/index.html" target="_blank">API Reference</a>
              </li>
              <li><a href="https://www.smily.com" target="_blank">Smily.com</a></li>
              <li><a href="https://github.com/BookingSync/channel-api-docs" target="_blank"><i class="fa fa-github fa-fw fa-2x"></i></a></li>
            </ul>
          </div>
        </div>
      </nav>

<div class="container content">
  <div class="row">
    <div class="col-md-3 col-md-push-9">
      <div class="panel panel-default">
        <div class="list-group">
          <a class="list-group-item" href="/guides/api-overview">API overview</a>
          <a class="list-group-item" href="/guides/getting-started">Getting Started</a>
          <a class="list-group-item" href="/guides/accounts-synchronization">Accounts synchronization</a>
          <a class="list-group-item" href="/guides/rentals-synchronization">Rentals synchronization</a>
          <a class="list-group-item" href="/guides/create-a-booking-payments-on-partner-side">Create a booking (payments on partner side)</a>
          <a class="list-group-item" href="/guides/create-a-booking-with-smily-payment-gateway">Create a booking (payments on our side)</a>
          <a class="list-group-item" href="/guides/booking-cancelation">Booking cancelation</a>
        </div>
      </div>
    </div>
    <div class="col-md-9 col-md-pull-3">
      <div class="panel panel-default">
        <div class="panel-body guide-body">
          <h2 id="accounts-synchronization">Accounts synchronization</h2>

<ol id="markdown-toc">
  <li><a href="#preface" id="markdown-toc-preface">Preface</a></li>
  <li><a href="#get-all-accounts" id="markdown-toc-get-all-accounts">Get All Accounts</a></li>
  <li><a href="#code-examples" id="markdown-toc-code-examples">Code examples</a></li>
</ol>

<h3 id="preface">Preface</h3>

<p>The Accounts endpoint enables partners to retrieve a list of accounts interested in publishing their listings on the partner’s website. Partners can use this endpoint to identify potential accounts for onboarding, which may involve signing contracts and other necessary steps.</p>

<h3 id="get-all-accounts">Get All Accounts</h3>

<p>Retrieve a list of accounts that wish to publish their listings on a partner’s website. Refer to the <a href="https://demo.platforms.bookingsync.com/api-docs/index.html">Swagger documentation</a> for detailed specifications.</p>

<blockquote>
  <p>Note: Pagination is not supported for this endpoint.</p>
</blockquote>

<blockquote>
  <p>Important: If an account is no longer visible in the list, ensure to disable the corresponding account and rentals.</p>
</blockquote>

<blockquote>
  <p>Recommendation: We suggest to do synchronization of accounts every 12-24 hours.</p>
</blockquote>

<h3 id="code-examples">Code examples</h3>

<div class="tabbable"><ul class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#content-1-0">cURL</a></li>
<li class=""><a data-toggle="tab" href="#content-1-1">Ruby</a></li>
<li class=""><a data-toggle="tab" href="#content-1-2">Python</a></li>
<li class=""><a data-toggle="tab" href="#content-1-3">Java</a></li></ul><div class="tab-content"><div id="content-1-0" class="tab-pane fade in active"><pre><code class="language-bash">TOKEN="YOUR_TOKEN"
API_URL="API_URL"

curl -X GET \
  "$API_URL/api/ota/v1/accounts" \
  -H "User-Agent: API Client" \
  -H "Accept: application/vnd.api+json" \
  -H "Content-Type: application/vnd.api+json" \
  -H "Authorization: Bearer $TOKEN"</code></pre></div>
<div id="content-1-1" class="tab-pane fade in "><pre><code class="language-ruby">require 'excon'
require 'json'

token = "YOUR_TOKEN"
api_url = "API_URL"
media_type = "application/vnd.api+json"
options = {
  headers: {
    "User-Agent" =&gt; "Api client",
    "Accept" =&gt; media_type,
    "Content-Type" =&gt; media_type,
    "Authorization" =&gt; "Bearer #{token}"
  }
}
request = Excon.new(URI.join(api_url, "/api/ota/v1/accounts").to_s, options)
response = request.request(method: :get)

response.status

already_import_accounts_ids = get_imported_accounts_ids # get an array of already imported accounts, Ex result: [1,2,3]

json = JSON.parse(response.body)
json["data"].each do |account|
  # Import accounts
  import_account(account["id"], account["attributes"]["name"])
end

accounts_for_disabling = already_import_accounts_ids - json["data"].pluck("id")
disable_accounts_and_rentals(accounts_for_disabling) # Disable accounts</code></pre></div>
<div id="content-1-2" class="tab-pane fade in "><pre><code class="language-python">import requests

token = "YOUR_TOKEN"
api_url = "API_URL"
media_type = "application/vnd.api+json"
headers = {
    "User-Agent": "API Client",
    "Accept": media_type,
    "Content-Type": media_type,
    "Authorization": f"Bearer {token}"
}
response = requests.get(f"{api_url}/api/ota/v1/accounts", headers=headers)

response_status = response.status_code

# Assuming you have a function to retrieve already imported account IDs: get_imported_accounts_ids
already_import_accounts_ids = get_imported_accounts_ids()

json_data = response.json()
for account in json_data["data"]:
    # Import accounts
    import_account(account["id"], account["attributes"]["name"])

accounts_for_disabling = [account_id for account_id in already_import_accounts_ids if account_id not in [a["id"] for a in json_data["data"]]]
disable_accounts_and_rentals(accounts_for_disabling)  # Disable accounts</code></pre></div>
<div id="content-1-3" class="tab-pane fade in "><pre><code class="language-java">import okhttp3.MediaType;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
import org.json.JSONArray;
import org.json.JSONObject;

public class AccountSynchronization {

    public static void main(String[] args) {
        String token = "YOUR_TOKEN";
        String api_url = "API_URL";
        MediaType mediaType = MediaType.parse("application/vnd.api+json");

        OkHttpClient client = new OkHttpClient();

        Request request = new Request.Builder()
                .url(api_url + "/api/ota/v1/accounts")
                .addHeader("User-Agent", "API Client")
                .addHeader("Accept", mediaType.toString())
                .addHeader("Content-Type", mediaType.toString())
                .addHeader("Authorization", "Bearer " + token)
                .build();

        try {
            Response response = client.newCall(request).execute();
            int responseStatus = response.code();

            // Assuming you have a function to retrieve already imported account IDs: getImportedAccountIds()
            JSONArray alreadyImportAccountIds = getImportedAccountIds();

            JSONObject responseBody = new JSONObject(response.body().string());
            JSONArray accounts = responseBody.getJSONArray("data");

            for (int i = 0; i &lt; accounts.length(); i++) {
                JSONObject account = accounts.getJSONObject(i);
                // Import accounts
                importAccount(account.getInt("id"), account.getJSONObject("attributes").getString("name"));
            }

            JSONArray accountsForDisabling = new JSONArray();
            for (int i = 0; i &lt; alreadyImportAccountIds.length(); i++) {
                int accountId = alreadyImportAccountIds.getInt(i);
                boolean found = false;
                for (int j = 0; j &lt; accounts.length(); j++) {
                    if (accounts.getJSONObject(j).getInt("id") == accountId) {
                        found = true;
                        break;
                    }
                }
                if (!found) {
                    accountsForDisabling.put(accountId);
                }
            }
            // Disable accounts
            disableAccountsAndRentals(accountsForDisabling);

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // Define your functions here:
    private static JSONArray getImportedAccountIds() {
        // Implement your logic to get imported account IDs
        return new JSONArray();
    }

    private static void importAccount(int accountId, String accountName) {
        // Implement your logic to import accounts
    }

    private static void disableAccountsAndRentals(JSONArray accountIds) {
        // Implement your logic to disable accounts and rentals
    }
}</code></pre></div></div></div>

<p>Please replace <code>YOUR_TOKEN</code> and <code>API_URL</code> with your actual authentication token and API URL in the Python code.</p>

<p>Additionally, make sure you have the necessary functions <strong>get_imported_accounts_ids</strong>, <strong>import_account</strong>, and <strong>disable_accounts_and_rentals</strong> defined and implemented in your Python script.</p>

        </div>
      </div>
    </div>
  </div>
</div>
    </div>
  </body>
</html>

